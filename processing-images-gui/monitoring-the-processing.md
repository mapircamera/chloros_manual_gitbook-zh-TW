# 处理监控

处理启动后，Chloros提供多种方式来监控进度、排查问题并了解数据集的处理状态。本页将说明如何追踪处理进程并解读Chloros提供的信息。

## 进度条概述

顶部标题栏的进度条实时显示处理状态及完成百分比。

### 免费模式进度条

针对未持有Chloros+许可证的用户：

**双阶段进度显示：**

1. **目标检测** - 在图像中定位校准目标
2. **处理阶段** - 执行校正并导出数据

**进度条显示：**

* 整体完成百分比（0-100%）
* 当前阶段名称
* 简约横向条形可视化

### Chloros+ 进度条

针对持有 Chloros+ 许可证的用户：

**四阶段进度显示：**

1. **检测** - 定位校准目标
2. **分析** - 检查图像并准备处理流程
3. **校准** - 应用晕影与反射率校正
4. **导出** - 保存处理后文件

**交互功能：**

* **悬停**进度条可展开四阶段面板
* **点击**进度条可冻结/固定展开面板
* **再次点击**解除冻结，鼠标移出时自动隐藏
* 各阶段独立显示进度（0-100%）

***

## 处理阶段详解

### 第一阶段：检测（目标识别）

**处理流程：**

* Chloros扫描标记目标复选框的图像
* 计算机视觉算法识别4个校准面板
* 从每个面板提取反射率值
* 记录目标时间戳以安排正确校准

**耗时：**

* 含标记目标：10-60秒
* 无标记目标：5-30+分钟（扫描所有图像）

**进度指示：**

* 检测中：0% → 100%
* 已扫描图像数量
* 目标检测数量

**注意事项：**

* 若目标标记正确，应快速完成
* 若耗时过长，可能是目标未被标记
* 请检查调试日志中的&quot;目标检测成功&quot;提示

### 第二阶段：分析

**当前操作：**

* 读取图像EXIF元数据（时间戳、曝光参数）
* 根据目标时间戳确定校准策略
* 组织图像处理队列
* 准备并行处理任务（仅限Chloros+）

**耗时：**5-30秒

**进度指示：**

* 分析中：0% → 100%
* 快速阶段，通常迅速完成

**需关注事项：**

* 进度应持续推进无停滞
* 元数据缺失警告将显示在调试日志

### 第三阶段：校准

**当前操作：**

* **去拜耳化**：将RAW拜耳阵列转换为三通道图像
* **暗角校正**：消除镜头边缘暗化现象
* **反射率校准**：参照目标值进行归一化处理
* **指数计算**：计算多光谱指数
* 对每张图像执行完整处理流程

**耗时：**占总处理时间的大部分（60-80%）

**进度指示：**

* 校准中：0% → 100%
* 当前处理图像
* 已完成图像 / 总图像数

**处理模式：**

* **自由模式**：顺序处理单张图像
* **Chloros+模式**：同时处理最多16张图像
* **GPU加速**：显著提升此阶段处理速度

**需关注事项：**

* 图像数量显示稳定推进
* 通过调试日志查看单张图像完成提示
* 注意图像质量或校准问题的警告信息

### 第四阶段：导出

**处理内容：**

* 将校准图像按选定格式写入磁盘
* 导出带LUT色彩的多光谱指数图像
* 创建相机模型子文件夹
* 保留原始文件名并添加相应后缀

**耗时：** 总处理时间的10-20%

**进度指示：**

* 导出进度：0% → 100%
* 文件写入状态
* 输出格式与目标路径

**需关注事项：**

* 磁盘空间警告
* 文件写入错误
* 所有配置输出的完成状态

***

## 调试日志标签页

调试日志提供详细的处理进度及异常信息。

### 访问调试日志

1. 点击左侧边栏的**调试日志** <img src="../.gitbook/assets/icon_log.JPG" alt="" data-size="line"> 图标
2. 日志面板展开，显示实时处理信息
3. 自动滚动展示最新日志

### 日志信息解析

#### 信息日志（白色/灰色）

常规处理更新：

```
[INFO] Processing started
[INFO] Target detected in IMG_0015.RAW - 4 panels found
[INFO] Calibrating IMG_0234.RAW
[INFO] Exported NDVI image: IMG_0234_NDVI.tif
[INFO] Processing complete
```

#### 警告日志（黄色）

非致命性问题（不停止处理）：

```
[WARN] No GPS data found in IMG_0145.RAW
[WARN] Target image timestamp gap > 30 minutes
[WARN] Low contrast in calibration panel - results may vary
```

**操作：**处理后审查警告，但无需中断

#### 错误消息（Red）

可能导致处理失败的严重问题：

```
[ERROR] Cannot write file - disk full
[ERROR] Corrupted image file: IMG_0299.RAW
[ERROR] No targets detected - enable reflectance calibration or mark target images
```

**操作：**停止处理，解决错误后重启

### 常见日志信息

| 信息                          | 含义                                | 所需操作                                         |
| -------------------------------- | -------------------------------------- | ----------------------------------------------------- |
| &quot;在\[文件名\]中检测到目标&quot; | 校准目标检测成功                        | 无 - 正常                                         |
| &quot;处理第X张图像（共Y张）&quot;        | 当前进度更新                            | 无 - 正常                                         |
| &quot;未检测到目标&quot;               | 未检测到校准目标                        | 标记目标图像或禁用反射率校准                            |
| &quot;磁盘空间不足&quot;        | 输出存储空间不足          | 释放磁盘空间                                    |
| &quot;跳过损坏文件&quot;        | 图像文件已损坏                  | 从SD卡重新复制文件                             |
| &quot;PPK数据已应用&quot;               | 应用.daq文件中的GPS校正数据 | 无异常 - 正常状态                                         |

### 复制日志数据

为故障排查或技术支持复制日志：

1. 打开调试日志面板
2. 点击**&quot;复制日志&quot;**按钮（或右键点击→全选）
3. 粘贴至文本文件或邮件
4. 如有需要发送至MAPIR技术支持

***

## 系统资源监控

### CPU使用率

**自由模式：**

* 1个CPU核心约100%负载
* 其他核心空闲或可用
* 系统保持响应

**Chloros+并行模式：**

* 多核80-100%负载（最多16核）
* 整体CPU利用率较高
* 系统响应可能变慢

**监控方式：**

* Windows 任务管理器（Ctrl+Shift+Esc）
* 性能选项卡 → CPU 部分
* 查找 &quot;Chloros&quot; 或 &quot;chloros-backend&quot; 进程

### 内存（RAM）使用率

**典型使用场景：**

* 小型项目（&lt;100张图像）：2-4 GB
* 中型项目（100-500张图像）：4-8 GB
* 大型项目（500+张图像）：8-16 GB
* Chloros+并行模式将消耗更多内存

**内存不足时：**

* 处理更小批量数据
* 关闭其他应用程序
* 若需长期处理大型数据集，请升级内存

### GPU使用情况（Chloros+配合CUDA）

启用GPU加速时：

* NVIDIA GPU利用率显著提升（60-90%）
* 显存使用量增加（需4GB+显存）
* 校准阶段显著提速

**监控方式：**

* NVIDIA系统托盘图标
* 任务管理器→性能→GPU
* GPU-Z等监控工具

### 磁盘I/O

**预期表现：**

* 分析阶段出现高磁盘读取
* 导出阶段出现高磁盘写入
* SSD 速度远快于 HDD

**性能优化建议：**

* 尽可能使用 SSD 存储项目文件夹
* 大型数据集避免使用网络驱动器
* 确保磁盘未接近满载（影响写入速度）

***

## 处理过程中问题检测

### 警告信号

**进度停滞（5分钟以上无变化）：**

* 检查调试日志中的错误
* 确认可用磁盘空间
* 通过任务管理器验证Chloros进程是否运行

**频繁出现错误信息：**

* 停止处理并排查错误
* 常见原因：磁盘空间不足、文件损坏、内存问题
* 参见下方故障排除章节

**系统无响应：**

* Chloros+并行模式占用过多资源
* 考虑减少并发任务或升级硬件
* 自由模式资源消耗较低

### 处理中止时机

出现以下情况时应停止处理：

* ❌ &quot;磁盘已满&quot;或&quot;无法写入文件&quot;错误
* ❌ 反复出现图像文件损坏错误
* ❌ 系统完全冻结（无响应）
* ❌ 发现配置错误参数
* ❌ 导入错误图像

**停止操作步骤：**

1. 点击**停止/取消按钮**（替代开始按钮）
2. 处理立即终止，进度数据丢失
3. 修复问题后从头开始重新处理

***

## 处理过程中的故障排除

### 处理速度极慢

**可能原因：**

* 未标记目标图像（扫描全部图像）
* 使用HDD而非SSD存储
* 系统资源不足
* 配置过多索引
* 访问网络驱动器

**解决方案：**

1. 若刚启动且处于检测阶段：取消操作→标记目标图像→重启
2. 长期解决方案：使用SSD→减少索引数量→升级硬件
3. 处理大型数据集时考虑使用CLI批处理工具

### &quot;磁盘空间不足&quot;警告

**解决方案：**

1. 立即释放磁盘空间
2. 将项目移至空间充足的驱动器
3. 减少导出索引数量
4. 使用JPG格式替代TIFF（文件更小）

### 频繁出现&quot;文件损坏&quot;提示

**解决方案：**

1. 从SD卡重新复制图像以确保完整性
2. 检测SD卡错误
3. 从项目中移除损坏文件
4. 继续处理剩余图像

### 系统过热/降频

**解决方案：**

1. 确保通风良好
2. 清理计算机散热孔积尘
3. 降低处理负载（使用Free模式替代Chloros+）
4. 选择气温较低时段进行处理

***

## 处理完成通知

处理完成时：

* 进度条达到100%
* 调试日志中出现**&quot;处理完成&quot;**提示
* 开始按钮重新启用
* 所有输出文件存放于相机型号子文件夹

***

## 后续步骤

处理完成后：

1. **检查结果** - 参见[处理收尾指南](finishing-the-processing.md)
2. **检查输出文件夹** - 确认所有文件导出正确
3. **查看调试日志** - 检查是否有警告或错误
4. **预览处理后的图像** - 使用图像查看器或外部软件

有关查看和使用处理结果的信息，请参阅[完成处理](finishing-the-processing.md)。
