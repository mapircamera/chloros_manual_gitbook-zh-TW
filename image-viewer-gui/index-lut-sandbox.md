# 指数/LUT沙盒

指数/LUT沙盒是Chloros图像查看器中的交互式工作区，支持实时进行多光谱指数计算与彩色可视化实验。这款强大工具可帮助您测试不同指数、优化数值范围，并创建可直接用于出版的可视化效果，无需重新处理整个数据集。

## 什么是索引/LUT沙盒？

### 功能定位

沙盒提供：

* **实时索引计算** - 即时应用任意植被指数
* **交互式LUT调整** - 精细调节色彩渐变与色域范围
* **工作流优化** - 批量处理前确定最佳参数设置

### 沙盒与项目处理对比

**指数/LUT沙盒（交互式）：**

* 单次处理单张图像
* 即时反馈
* 实验性与迭代性
* 不对文件作永久性修改
* 探索测试的理想选择

**项目处理（批量）：**

* 整组数据批量处理
* 预配置参数
* 生成永久输出文件
* 耗时较长
* 适用于最终确定参数时

{%提示 style=&quot;success&quot; %}
**最佳工作流**：先在沙盒中实验并确定最佳索引与LUT设置，再通过项目处理将这些设置应用于整个数据集。
{% endhint %}

***

## 使用索引/LUT沙盒

### 预计算索引原理解析

在Chloros中，索引可在项目处理阶段应用。要确定导出时需采用的索引与LUT设置，最便捷的方式是使用图像查看器沙盒。

沙盒支持以下操作：

* **应用新指数与色彩渐变（LUT）**以可视化数据
* **交互式调整可视化设置*** **查看**已计算的指数图像
* **检查**所有缩放级别的像素值

### 打开沙盒

通过**图像查看器**侧边栏标签访问索引/LUT沙盒： <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> 侧边栏选项卡：

1. 在文件浏览器图像网格中点击图像，它将在**图像查看器** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> 标签页中打开
2. 点击**图像查看器** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> 选项卡以展开左侧弹出式侧边栏（若尚未展开）

### 选择应用索引/LUT的图像

在图像查看器 <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> 沙盒中处理索引：

1. 在主图像网格中点击**打开图像**

2.**图像查看器** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> 标签页随即展开
3. 点击**图层下拉菜单**（查看器右上角）
4. 从下拉菜单选择图层：
   * RAW（反射率）

### 为图像应用指数

当图像全屏显示且**图像查看器** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> 标签侧边栏开启时：

1. 勾选侧边栏顶部的索引框
2. 从左侧下拉菜单选择相机滤镜
3. 从右侧下拉菜单选择所需索引公式
4. 将滤镜通道的彩色圆圈拖拽至下方索引公式对应位置
5. 公式有效时图像将更新并显示索引值
6. 移动鼠标光标可查看光标位置的数值
7. 放大查看单个像素及其关联数值

每个指数均具有特定数值范围与含义：

#### XPROTX示例

```

Formula: (NIR - Red) / (NIR + Red)

For Survey3W RGN camera:
NIR = 850nm band
Red = 661nm band

Result range: -1.0 to +1.0
Typical vegetation: 0.4 to 0.9
Stressed vegetation: 0.2 to 0.4
Bare soil: 0.0 to 0.2
Water: -0.1 to 0.1
```

完整指数公式文档请参阅[多光谱指数公式](../project-settings/multispectral-index-formulas.md)。

***

## 查找表（LUT）操作指南

### 什么是查找表？

**查找表（LUT）**通过数值索引映射颜色实现可视化：

* **输入**：索引像素值（例如 NDVI 0.65）
* **输出**：RGB 颜色（例如亮绿色）
* **用途**：使模式更易于观察和解读**灰度与彩色LUT对比：**

* 灰度：科学中性，呈现原始数据
* 彩色LUT：直观有力，突出模式差异

{% hint style=&quot;success&quot; %}
**可视化效能**：为灰度索引图像应用彩色LUT后，可瞬间识别模式、异常及关注区域。
{% endhint %}

### 为索引图像应用LUT

获取索引图像后：

1. 点击 <img src="../.gitbook/assets/image (1) (1).png" alt="" data-size="line"> &quot;+添加LUT&quot;按钮
2. 选择颜色渐变
3. 调整裁剪最小/最大端点
4. 调整裁剪模式
5. 在**图像查看器**<img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> 选项卡侧边栏中的**索引**框以应用LUT

### 选择颜色渐变

**渐变选择步骤：**

1. 在LUT面板中定位**彩色渐变条**

2. 将鼠标悬停其上查看可用渐变预设
3. 选择所需渐变
4. 勾选索引框后，图像将**即时更新**为新配色

{%提示 style=&quot;success&quot; %}
**最佳实践**：对于NDVI等植被指数，Red-Yellow-Green渐变最直观，因其符合自然色彩关联（绿色=健康，黄色=中等，红色=受胁）。
{% endhint %}

### 调整颜色类别

**类别控制**决定渐变中出现的离散色阶数量：**类别数量选项：*** **2-5级**：大范围分类，分区明显
* **6-10级**：平衡适中，分类效果佳
* **11-20级**：平滑过渡，视觉连续
* **20+级**：近乎连续，平滑度最大化**调整方法：**

1. 在LUT面板中，定位**渐变条下方的色块区域**

2. 通过+按钮增加类数
3. 双击色块可减少类数
4. 渐变效果将**实时**更新于图像**可视化效果：*** **少类（3-5类）**：形成鲜明区域，简化分类，便于区分类别
* **中等类（6-10类）**：平衡方案，适用于多数场景
* **多类（15-20类）**：平滑过渡，精细变化，呈现照片级效果**适用场景：*** **少类（3-5类）**：演示幻灯片、分类地图、简易报告
* **中类（6-10类）**：常规分析、均衡细节、标准报告
* **多类（15-20类）**：科学分析、精细检测、出版级输出

### 精细调整数值范围

**数值范围控制**决定渐变色中各指数值对应的颜色：**LUT面板中的范围控制：*** **最小值**：色阶下限
* **最大值**：色阶上限
* **中间值**：自动分布于最小值与最大值之间（基于类别数量）

#### 调整最小/最大值

**调整值范围步骤：**

1. 在LUT面板中定位**最小值**和**最大值**输入框
2. 点击**最小值**输入框
3. 输入目标最小值（例如：`0.2`）
4. 按**Enter**键或点击字段外部
5. 对**最大值**字段重复操作（例如：`0.9`）
6. 可视化效果**即时更新**{% 提示 style=&quot;info&quot; %}**自动缩放**：初次应用LUT时，Chloros会自动将最小/最大值设为图像实际数据范围。随后可缩小该范围以聚焦特定关注值域。
{% endhint %}

**范围调整示例：*** **全范围**：`-1.0` 至 `1.0`（显示所有可能数值）
* **植被聚焦**：`0.2`至`0.9`（排除裸土与水体）
* **仅健康植被**：`0.5`至`0.9` （仅突出显示旺盛植被）
* **胁迫检测**：`0.2` 至 `0.5`（强调问题区域）
* **自定义范围**：根据观测像素值调整**为何调整范围？*** **增强** 目标区域的对比度
* **排除无关数值**（如水体、裸露土壤）
* **标准化可视化效果**（跨多幅图像或不同日期）
* **突出细微差异**（在窄值域内）

### 裁剪超限值

当像素值超出定义的最小/最大范围时，可通过**裁剪模式**控制其显示方式。

#### **可用裁剪模式选项：**

#### 1. 极值裁剪

* 像素值**低于下限**→ 显示为渐变色系的**首色**（如红色）
* 像素值**高于上限**→ 显示为渐变色系的**末色**（如绿色）
* **应用场景**：强调极端值，通过饱和色显示数据范围两端的完整数据
* **示例**：NDVI值低于0.2均显示为红色，高于0.9均显示为绿色

#### 2. 透明背景

* **超出范围**的像素变为**完全透明*** 仅**在范围内的像素**显示颜色渐变
* **应用场景**：GIS叠加层，隔离特定数值范围，仅突出显示关注区域
* **示例**：仅显示NDVI 0.4-0.7区间为彩色，其余区域透明

{% hint style=&quot;warning&quot; %}
**透明度限制**：透明像素在查看器中将显示为背景色。处理时导出为PNG格式可保留透明度，JPG格式则不可。
{% endhint %}

#### 3. 索引背景

* **超出范围**的像素以**灰度**显示 （显示原始指数值）
* **在范围内**的像素显示**色彩渐变*** **应用场景**：细微高亮处理，在保持上下文的同时突出重点区域
* **示例**：以色彩高亮显示受胁植被（NDVI 0.3-0.5），健康区域以灰色呈现

#### 4. 原生背景

* **超出范围**像素显示**原始多光谱图像*** **在范围内的**像素显示**色彩渐变*** **应用场景**：最直观模式——融合自然图像背景与分析性色彩叠加
* **示例**：呈现实际田间/作物外观，同时叠加色码标注的胁迫区域

### 选择合适的裁剪模式

| 裁剪模式              | 最佳适用场景                                   | 可视化风格           |
| -------------------------- | ------------------------------------------ | ---------------------------- |
| **最小值与最大值**    | 全数据展示，科学分析     | 所有像素着色           |
| **透明背景**         | GIS叠加，特定范围隔离     | 范围着色，超出空白 |
| **索引背景**       | 微调强调，保持数据关联性  | 范围着色，超出范围灰度  |
| **原始背景**    | 报告演示，直观分析需求 | 范围着色，超出范围照片 |

### 创建自定义LUT颜色

为实现可视化全局控制，可通过编辑单个色彩停点创建**自定义渐变色**。**创建自定义渐变步骤：**

1. 在LUT面板中定位**渐变预览条**

2. 查找渐变下方**色块方格**

3.**点击色阶点**进行选定
4. 弹出**颜色选择器**

5. 通过以下方式选择新颜色：
   * **色轮**：直观选色
   * **RGB/HSV滑块**：精准调色
   * **十六进制代码输入**：精确指定颜色（如红色输入`#FF0000`）
6. 点击色板外部**应用新颜色**

7. 图像中的渐变效果**即时更新**

**添加或删除颜色停靠点：*** **添加停靠点**：点击+图标在末尾添加新色块
* **删除停靠点**：双击颜色方块移除该色块**定制策略：*** **反转渐变**：颠倒颜色顺序以逆转含义（例如绿色=低，红色=高）
* **品牌色**：匹配组织报告的配色方案
* **色盲友好**：使用橙蓝或紫黄配色组合
* **打印优化**：选择同时适用于彩色和灰度打印的颜色
* **多阈值**：在特定数值阈值处使用不同颜色进行分类

{%提示 style=&quot;info&quot; %}
**保存自定义渐变**：可保存并重复使用自定义渐变。点击LUT面板中的保存图标，即可将自定义配色方案保存供后续使用。
{% endhint %}

***

## 互动式工作流程

### 实时更新

沙盒中的所有LUT调整均可**即时交互式**更新图像：

* **切换图层** → 图像即时变化
* **选择渐变** → 颜色即时更新
* **调整数值范围** → 对比度实时变化
* **更改类** → 渐变平滑度即时更新
* **修改剪裁** → 背景显示即时变化
* **编辑颜色** → 自定义渐变即时应用**无需&quot;应用&quot;按钮** - 所有更改均实时交互！

{%提示 style=&quot;success&quot; %}
**实时反馈**：即时可视化反馈助您快速尝试不同设置，直至找到满足分析需求的最佳可视化方案。
{%结束提示 %}

### 迭代优化工作流

**典型LUT优化流程：**

1.**选择指数层**（例如：RAW（反射率））
2. **应用指数** - 选择相机滤镜与指数公式，将彩色圆点拖拽至指数公式中对应位置
3. **应用LUT梯度** - 从Red-Yellow-Green预设开始
4. **检查像素值** - 移动光标观察数值范围
5. **调整最小/最大值** - 缩小范围聚焦植被（例如0.2至0.9）
6. **选择裁剪模式** - 尝试&quot;原始背景&quot;以保留上下文
7. **精细调整色彩** - 根据需要定制渐变以突出特定区域
8. **最终确认设置** - 记录参数并复制至项目设置以供导出处理

### 像素值检测

理解实际像素值对设定有效LUT范围至关重要：

**检测方法：**

1. 当图像勾选索引框或同时勾选索引框与LUT框时，像素值将显示
2. **将光标悬停**于图像不同区域
3. **观察悬停时图例中显示的像素值**

4. 放大查看带浮动数值的高亮单个像素
5. **记录**不同特征的数值范围：
   * **健康植被**：例如 NDVI 0.55-0.85
   * **受胁植被**：例如 NDVI 0.30-0.50
   * **裸露土壤**：例如 NDVI 0.05-0.25
   * **水体**（若存在）：例如 NDVI -0.05 至 0.10**利用像素值设定LUT范围：**检查像素值后，相应调整LUT的最小/最大值：**示例场景：*** **观测结果**：土壤值 = 0.05-0.25，胁迫值 = 0.25-0.50，健康值 = 0.50-0.85
* **目标**：仅可视化植物健康状况 （排除土壤）
* **LUT设置**：最小值=`0.25`，最大值=`0.85`
* **裁剪**：&quot;原始背景&quot;模式以自然色呈现土壤
* **结果**：色彩渐变仅作用于植被，土壤保持原始图像状态

{% hint style=&quot;info&quot; %}
**动态范围**：不同作物、季节及生长阶段对应不同数值区间。设置LUT范围前务必核查特定数据集的像素值。
{% endhint %}

***

## 自定义索引 (Chloros+)

### 创建自定义索引公式

{% hint style=&quot;info&quot; %}
**创建位置**：自定义索引可在处理前通过**项目设置**配置，也可在图像查看器沙盒侧边栏中创建。
{% endhint %}

**创建自定义索引步骤：**

1.**打开项目设置**（处理前）或图像查看器沙盒侧边栏
2. 导航至**索引公式下拉菜单**

3. 查找**&quot;自定义&quot;**选项（需使用Chloros+许可证登录）
4. 使用波段变量**定义公式**：
   * 波段名称：`NIR`、`Red`、`Green`、`Blue`、`RedEdge` 等
   * 运算符：`+`、`-`、`*`、`/`、`^`（指数运算符）
   * 函数：`sqrt()`、`abs()` 等（如支持）
   * 括号：`()`（用于运算顺序）
5. **命名索引**（例如&quot;MyIndex&quot;或&quot;CustomNDVI&quot;）
6. **保存配置**

**自定义公式示例：**

```

Modified NDVI with offset:
(NIR - Red) / (NIR + Red + 0.5)

Simple ratio:
NIR / Red

Complex multi-band:
(NIR - Red) / (NIR + Red - Blue)

Exponential index:
(NIR / Red) ^ 2
```

{% 提示 style=&quot;warning&quot; %}
**公式验证**：确保公式使用的波段在相机中可用。例如，RedEdge仅适用于配备RedEdge滤镜的相机。
{% endhint %}

***

## 后续步骤

了解索引/LUT沙盒功能后：

* **应用于处理**：在[项目设置](../project-settings/project-settings.md)中使用发现的参数
* **批量处理**：将优化索引应用于完整数据集
* **深入学习**：阅读[多光谱索引公式](../project-settings/multispectral-index-formulas.md)

相关文档：

* [**图像图层**](image-layers.md) - 图层管理与可视化
* [**全屏打开图像**](opening-an-image-full-screen.md) - 图像查看器基础
* [**图像处理（GUI）**](../processing-images-gui/adding-files-to-a-project.md) - 完整处理工作流
